{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4 d-print-none">
    <h2 class="fw-bold text-primary">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©</h2>
    <button onclick="window.print()" class="btn btn-success">
        ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
    </button>
</div>

<div class="card mb-4 d-print-none">
    <div class="card-body">
        <form method="GET" class="row g-3 align-items-end">
            <div class="col-auto">
                <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                <select name="type" class="form-select" id="reportType" onchange="updateInputType()">
                    <option value="day" {% if filter_type == 'day' %}selected{% endif %}>ÙŠÙˆÙ…ÙŠ</option>
                    <option value="month" {% if filter_type == 'month' %}selected{% endif %}>Ø´Ù‡Ø±ÙŠ</option>
                </select>
            </div>
            <div class="col-auto">
                <label class="form-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                <input type="date" name="date" class="form-control" id="dateInput" value="{{ date_str }}">
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-primary">Ø¹Ø±Ø¶</button>
            </div>
        </form>
    </div>
</div>

<div class="print-header d-none d-print-block text-center mb-4">
    <h3>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù†Ø§ÙˆØ¨Ø§Øª - {{ filter_type == 'day' and 'ÙŠÙˆÙ…ÙŠ' or 'Ø´Ù‡Ø±ÙŠ' }}</h3>
    <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: {{ date_str or 'Ø§Ù„ÙŠÙˆÙ…' }}</p>
</div>

<div class="table-responsive">
    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                <th>#</th>
                <th>Ø§Ù„ÙŠÙˆÙ…</th>
                <th>Ø§Ù„Ø­ØµØ©</th>
                <th>Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø£ØµÙ„ÙŠ</th>
                <th>Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø¨Ø¯ÙŠÙ„</th>
                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                <th class="signature-col">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø¨Ø¯ÙŠÙ„</th>
            </tr>
        </thead>
        <tbody>
            {% for sub in substitutions %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ sub.day_of_week }}</td>
                <td>{{ sub.period_number }}</td>
                <td>{{ sub.original_teacher.name }}</td>
                <td>{{ sub.covering_teacher.name }}</td>
                <td>{{ sub.created_at.strftime('%Y-%m-%d') }}</td>
                <td class="signature-col"></td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø§ÙˆØ¨Ø§Øª Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    function updateInputType() {
        const type = document.getElementById('reportType').value;
        const input = document.getElementById('dateInput');
        if (type === 'month') {
            input.type = 'month';
        } else {
            input.type = 'date';
        }
    }
    // Init on load
    updateInputType();
</script>

<style>
    @media print {
        .d-print-none { display: none !important; }
        .d-print-block { display: block !important; }
        .card { border: none; shadow: none; }
        body { background-color: white; }
        .signature-col { width: 150px; height: 50px; }
    }
</style>
{% endblock %}